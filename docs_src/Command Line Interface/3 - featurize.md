# Featurize

Featurize (`beep featurize`) is a way to robustly apply many feature generation routines (featurizers) with
different hyperparameters to large sets of files (e.g., a thousand structured cycler files).

The input to `beep featurize` is *N* structured/processed json files from `beep structure`.

The output of `beep featurize` is 1 feature matrix file (no matter how many featurizers are applied). Also, optionally *N x M* featurizer 
intermediate files for *M* featurizers (one for each featurizer applied to each file.)


![cli_featurize](../static/op_graphic_featurize.png)


## Featurization help dialog


```sh
$: beep featurize --help

Usage: beep featurize [OPTIONS] [FILES]...

  Featurize one or more files. Argument is a space-separated list of files or
  globs. The same features are applied to each file. Naming of output files is
  done automatically, but the output directory can be specified.

Options:
  -o, --output-filename FILE      Filename to save entre feature matrix to. If
                                  not specified, output filewill be named with
                                  FeatureMatrix-[timestamp].json.gz. If
                                  specified, overrides the output dir for
                                  saving the feature matrix to file.
  -d, --output-dir DIRECTORY      Directory to dump auto-named files to.
  -f, --featurize-with TEXT       Specify a featurizer to apply by class name,
                                  e.g. HPPCResistanceVoltageFeatures. To apply
                                  more than one featurizer, use multiple -f
                                  <FEATURIZER> commands. To apply sets ofcore
                                  BEEP featurizers, pass either 'all_features'
                                  for all features or'all_targets' for all
                                  targets (features which can be used as
                                  targets). Note if 'all_features' or
                                  'all_targets' is passed, other -f
                                  featurizers will be ignored. All feautrizers
                                  are attempted to apply with default
                                  hyperparameters; to specify your own
                                  hyperparameters, use --featurize-with-
                                  hyperparams.Classes from installed modules
                                  not in core BEEP can be specified with the
                                  class name in absolute import format, e.g.,
                                  my_package.my_module.MyClass.
  -h, --featurize-with-hyperparams TEXT
                                  Specify a featurizer to apply by class name
                                  with your own hyperparameters.(such as
                                  parameter directories or specific values for
                                  hyperparametersfor this featurizer), pass a
                                  dictionary in the format:
                                  '{"FEATURIZER_NAME": {"HYPERPARAM1":
                                  "VALUE1"...}}' including the single quotes
                                  around the outside and double quotes for
                                  internal strings.Custom hyperparameters will
                                  be merged with default hyperparameters if
                                  the hyperparameter dictionary is
                                  underspecified.
  --save-intermediates            Save the intermediate BEEPFeaturizers as
                                  json files. Filenames are autogenerated and
                                  saved in output-dir if specified; otherwise,
                                  intermediates are written to current working
                                  directory.
  --help                          Show this message and exit.

```



## Specifying outputs

The `beep featurize` command outputs a feature matrix as its required sole output. This file will
be auto-named if `--output-filename` is not specified. 

To include saving of intermediate featurizer files, use the `--save-intermediates` flag. These files will be auto-named and put into the CWD if `--output-dir` is not set.

Specifying `--output-dir` overrides `--output-filename` and will save *all* files (including intermediates) into this directory with automatic naming.



## Selecting featurizers to apply


`beep featurize` works with "core" features 
